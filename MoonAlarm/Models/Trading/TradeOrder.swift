//
//  TradeOrder.swift
//  MoonAlarm
//
//  Created by Kenneth Vaczi on 1/21/18.
//  Copyright Â© 2018 Vaczoway Solutions. All rights reserved.
//

import Foundation

class TradeOrder {
    
    // Fixed Settings //
    
    let symbolPair: String
    let side: BinanceAPI.OrderSide
    let type: BinanceAPI.OrderType
    let isTestOrder: Bool
    // assume processed immediately
    let timeInForce: BinanceAPI.TimeInForce = .ioc
    let quantity: Double
    
    // Mutating Settings //
    
    // Generated by binance, set after processing
    var uid: String? = nil
    // only needed for limit orders, set after processing for market orders
    var price: Price? = nil
    var status: BinanceAPI.OrderStatus = .new
    var quantityFilled: Double = 0
    
    init(pair: String, side: BinanceAPI.OrderSide, type: BinanceAPI.OrderType = .market,
         price: Price?, quantity: Double, isTest: Bool = true) {
        self.symbolPair = pair
        self.side = side
        self.type = type
        self.price = price
        self.quantity = quantity
        self.isTestOrder = isTest
    }
    
    func execute(callback: @escaping (_ isSuccess: Bool) -> Void) {
        guard self.status == .new else { callback(false); return }
        BinanceAPI.instance.postNewOrder(for: self) {
            (isSuccess, processedOrder) in
            callback(isSuccess)
        }
    }

}
